name: Build and Push Image

on:
  push:
    branches: ["*"]
env:
  IMAGE_NAME: ${{ secrets.DOCKER_USERNAME }}/${{ github.event.repository.name }}
jobs:
  build-push-sign:
    uses: kyledwilson/go-container-action/.github/workflows/build-push-sign.yml@main
    secrets: inherit

  # update_deploy_repo:
  #   runs-on: ubuntu-latest
  #   needs: push_to_registry
  #   name: update deploy repo image tag
  #   environment: Homelab
  #   steps:
  #     - name: checkout deploy repo
  #       uses: actions/checkout@master
  #       with:
  #         repository: ${{ github.REPOSITORY }}-deploy
  #         ref: refs/heads/main
  #         token: ${{ secrets.AUTH_TOKEN }}
  #     - name: set up kustomize
  #       uses: imranismail/setup-kustomize@v1
  #     - run: |
  #         cd base && kustomize edit set image myapp=${{ env.IMAGE_NAME }}:${{ github.SHA }} && cat kustomization.yaml
  #     - run: |
  #         git config user.name ${{ github.REPOSITORY_OWNER }}
  #         git config user.email ${{ secrets.EMAIL }}
  #         git add .
  #         git commit -m "bump ${{ env.IMAGE_NAME }} image tag to ${{ github.SHA }}"
  #         git push https://${{ secrets.AUTH_TOKEN }}@github.com/${{ github.REPOSITORY }}-deploy.git
